{"version":3,"sources":["../../server/controllers/user.js"],"names":["User","Op","sequelize","config","Users","req","res","salt","genSaltSync","Math","floor","random","body","firstName","lastName","email","password","encryptedPassword","hashSync","findOne","where","iLike","then","foundUser","status","json","statusCode","message","error","create","user","send","catch","err","compareSync","token","sign","id","role","process","env","SECRET_KEY","expiresIn","currentUser","update","updatedUser","subject","htmlOutput","findAll","users","userId","destroy","deletedUser","errorMessage"],"mappings":";;;;;;;AACA;;;AADA;;;;AAEA;;;;AACA;;;;AACA;;;;AACA;;;;;;;;;;AAEA,IAAMA,OAAO,iBAAOA,IAApB;AACA,IAAMC,KAAK,iBAAOC,SAAP,CAAiBD,EAA5B;AACA,iBAAOE,MAAP;;AAEA;;;;;IAIqBC,K;;;;;;;;;AAEjB;;;;;;;;mCAQWC,G,EAAKC,G,EAAI;;AAEhB;AACA,gBAAIC,OAAO,mBAAOC,WAAP,CAAmBC,KAAKC,KAAL,CAAWD,KAAKE,MAAL,KAAgB,EAA3B,CAAnB,CAAX;;AAHgB,4BAK+BN,IAAIO,IALnC;AAAA,gBAKVC,SALU,aAKVA,SALU;AAAA,gBAKCC,QALD,aAKCA,QALD;AAAA,gBAKWC,KALX,aAKWA,KALX;AAAA,gBAKkBC,QALlB,aAKkBA,QALlB;;AAMhB,gBAAIC,oBAAoB,mBAAOC,QAAP,CAAgBF,QAAhB,EAA0BT,IAA1B,CAAxB;;AAEAP,iBAAKmB,OAAL,CAAa;AACTC,uBAAO;AACHL,+CACKd,GAAGoB,KADR,EACgBN,KADhB;AADG;AADE,aAAb,EAOCO,IAPD,CAOM,UAACC,SAAD,EAAe;AACjB,oBAAIA,SAAJ,EAAe;AACX,2BAAOjB,IAAIkB,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AACxBC,oCAAY,GADY;AAExBC,iCAAS,6CAFe;AAGxBC,+BAAO;AAHiB,qBAArB,CAAP;AAKH;AACD,uBAAO5B,KAAK6B,MAAL,CAAY;AACfhB,+BAAWA,SADI;AAEfC,8BAAUA,QAFK;AAGfC,2BAAOA,KAHQ;AAIfC,8BAAUC;AAJK,iBAAZ,EAMNK,IANM,CAMD,UAACQ,IAAD,EAAU;AACZ,2BAAOxB,IAAIkB,MAAJ,CAAW,GAAX,EACFO,IADE,CACG;AACFL,oCAAY,GADV;AAEFC,0DAAgCG,KAAKjB,SAArC,SAAkDiB,KAAKhB,QAFrD;AAGFc,+BAAO;AAHL,qBADH,CAAP;AAMH,iBAbM,EAcNI,KAdM,CAcA;AAAA,2BAAO1B,IAAIkB,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBQ,GAArB,CAAP;AAAA,iBAdA,CAAP;AAeH,aA9BD,EA+BCD,KA/BD,CA+BO;AAAA,uBAAS1B,IAAIkB,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBG,KAArB,CAAT;AAAA,aA/BP;AAgCH;;;kCAESvB,G,EAAKC,G,EAAI;AAAA,6BACWD,IAAIO,IADf;AAAA,gBACTG,KADS,cACTA,KADS;AAAA,gBACFC,QADE,cACFA,QADE;;AAEXhB,iBAAKmB,OAAL,CAAa;AACTC,uBAAO;AACHL,+CACKd,GAAGoB,KADR,EACgBN,KADhB;AADG;AADE,aAAb,EAOCO,IAPD,CAOM,UAACC,SAAD,EAAe;AACjB,oBAAG,CAACA,SAAJ,EAAc;AACV,2BAAOjB,IAAIkB,MAAJ,CAAW,GAAX,EAAgBO,IAAhB,CAAqB;AACxBL,oCAAY,GADY;AAExBC,iCAAS,gCAFe;AAGxBC,+BAAO;AAHiB,qBAArB,CAAP;AAKH,iBAND,MAOK,IAAG,mBAAOM,WAAP,CAAmBlB,QAAnB,EAA6BO,UAAUP,QAAvC,CAAH,EACL;AACI,2BAAOV,IAAIkB,MAAJ,CAAW,GAAX,EAAgBO,IAAhB,CAAqB;AACxBL,oCAAY,GADY;AAExBC,iCAAS,mBAFe;AAGxBQ,+BAAO,uBAAIC,IAAJ,CAAS;AACZC,gCAAId,UAAUc,EADF;AAEZxB,uCAAWU,UAAUV,SAFT;AAGZC,sCAAUS,UAAUT,QAHR;AAIZC,mCAAOQ,UAAUR,KAJL;AAKZuB,kCAAMf,UAAUe;AALJ,yBAAT,EAMJC,QAAQC,GAAR,CAAYC,UANR,EAMoB,EAAEC,WAAW,KAAb,EANpB,CAHiB;AAUxBd,+BAAO;AAViB,qBAArB,CAAP;AAYH,iBAdI,MAcA;AACD,2BAAOtB,IAAIkB,MAAJ,CAAW,GAAX,EAAgBO,IAAhB,CAAqB;AACxBL,oCAAY,GADY;AAExBC,iCAAS,gBAFe;AAGxBC,+BAAO;AAHiB,qBAArB,CAAP;AAKH;AACJ,aApCD,EAqCCI,KArCD,CAqCO;AAAA,uBAAS1B,IAAIkB,MAAJ,CAAW,GAAX,EAAgBO,IAAhB,CAAqBH,KAArB,CAAT;AAAA,aArCP;AAsCP;;;iCAESvB,G,EAAKC,G,EAAI;AACjB,mBAAOA,IAAIyB,IAAJ,CAAS;AACdY,6BAAatC,IAAIsC;AADH,aAAT,CAAP;AAGD;;;oCAEWtC,G,EAAKC,G,EAAI;AAAA,6BACSD,IAAIO,IADb;AAAA,gBACXG,KADW,cACXA,KADW;AAAA,gBACJC,QADI,cACJA,QADI;;AAEjBhB,iBAAKmB,OAAL,CAAa;AACTC,uBAAO;AACHL,+CACKd,GAAGoB,KADR,EACgBN,KADhB;AADG;AADE,aAAb,EAOKO,IAPL,CAOU,UAACC,SAAD,EAAe;AACjB,oBAAG,CAACA,SAAJ,EAAc;AACV,2BAAOjB,IAAIkB,MAAJ,CAAW,GAAX,EAAgBO,IAAhB,CAAqB;AACxBL,oCAAY,GADY;AAExBC,iCAAS,gCAFe;AAGxBC,+BAAO;AAHiB,qBAArB,CAAP;AAKH,iBAND,MAOK,IAAG,mBAAOM,WAAP,CAAmBlB,QAAnB,EAA6BO,UAAUP,QAAvC,CAAH,EACL;AACI;AACAhB,yBAAK4C,MAAL,CAAY,EAAEN,MAAM,IAAR,EAAZ,EAA4B;AACxBlB,+BAAO;AACHiB,gCAAId,UAAUc;AADX;AADiB,qBAA5B,EAKCf,IALD,CAKM,UAACuB,WAAD,EAAiB;AACnB,4BAAIC,UAAU,gDAAd;AACA,4BAAIC,8IAEWxB,UAAUV,SAFrB,SAEkCU,UAAUT,QAF5C,4KAKsBS,UAAUV,SALhC,8DAMqBU,UAAUT,QAN/B,0DAOiBS,UAAUR,KAP3B,uTAAJ;AAeA,8CAAOQ,UAAUR,KAAjB,EAAwB+B,OAAxB,EAAiCA,OAAjC,EAA0CC,UAA1C;AACA,+BAAOzC,IAAIkB,MAAJ,CAAW,GAAX,EAAgBO,IAAhB,CAAqB;AACxBL,wCAAY,GADY;AAExBC,qCAAS,gFAAgFkB,YAAY9B,KAF7E;AAGxBe,kCAAMe;AAHkB,yBAArB,CAAP;AAKH,qBA5BD;AA6BH,iBAhCI,MAgCE;AACH,2BAAOvC,IAAIkB,MAAJ,CAAW,GAAX,EAAgBO,IAAhB,CAAqB;AACxBL,oCAAY,GADY;AAExBC,iCAAS,gBAFe;AAGxBC,+BAAO;AAHiB,qBAArB,CAAP;AAKH;AACJ,aAtDL,EAuDKI,KAvDL,CAuDW;AAAA,uBAAS1B,IAAIkB,MAAJ,CAAW,GAAX,EAAgBO,IAAhB,CAAqBH,KAArB,CAAT;AAAA,aAvDX;AAwDH;;;iCAEQvB,G,EAAKC,G,EAAI;AACdN,iBAAKgD,OAAL,GACK1B,IADL,CACU,UAAC2B,KAAD,EAAW;AACb,uBAAO3C,IAAIkB,MAAJ,CAAW,GAAX,EAAgBO,IAAhB,CAAqB;AACxBJ,6BAAS,iBADe;AAExBD,gCAAY,GAFY;AAGxBuB;AAHwB,iBAArB,CAAP;AAKH,aAPL,EAQKjB,KARL,CAQW;AAAA,uBAAS1B,IAAIkB,MAAJ,CAAW,GAAX,EAAgBO,IAAhB,CAAqBH,KAArB,CAAT;AAAA,aARX;AASH;;;oCAEWvB,G,EAAKC,G,EAAI;AAAA,gBACX4C,MADW,GACA7C,IAAIO,IADJ,CACXsC,MADW;;AAEjBlD,iBAAKmB,OAAL,CAAa;AACTC,uBAAO;AACHiB,wBAAIa;AADD;AADE,aAAb,EAKK5B,IALL,CAKU,UAACC,SAAD,EAAe;AACjBvB,qBAAKmD,OAAL,CAAa;AACT/B,2BAAO;AACHiB,4BAAId,UAAUc;AADX;AADE,iBAAb,EAKKf,IALL,CAKU,UAAC8B,WAAD,EAAiB;AACnB,wBAAGA,WAAH,EAAe;AACX9C,4BAAIkB,MAAJ,CAAW,GAAX,EAAgBO,IAAhB,CAAqB;AACjBJ,qCAAS,oCADQ;AAEjBC,mCAAO,KAFU;AAGjBE,kCAAMP;AAHW,yBAArB;AAKH,qBAND,MAMK;AACDjB,4BAAIyB,IAAJ,CAAS;AACLJ,qCAAS,wCADJ;AAELC,mCAAO;AAFF,yBAAT;AAIH;AACJ,iBAlBL,EAmBKI,KAnBL,CAmBW;AAAA,2BAAS1B,IAAIkB,MAAJ,CAAW,GAAX,EAAgBO,IAAhB,CAAqB;AACjCH,+BAAO,IAD0B;AAEjCD,iCAAS,8BAFwB;AAGjC0B,sCAAczB;AAHmB,qBAArB,CAAT;AAAA,iBAnBX;AAwBH,aA9BL;AA+BH;;;;;;kBA7MgBxB,K","file":"user.js","sourcesContent":["import dotenv from 'dotenv';\r\n// import Validator from 'validatorjs';\r\nimport bcrypt from 'bcryptjs';\r\nimport jwt from 'jsonwebtoken';\r\nimport models from '../models';\r\nimport mailer from '../middleware/mailer';\r\n\r\nconst User = models.User;\r\nconst Op = models.sequelize.Op;\r\ndotenv.config();\r\n\r\n/**\r\n * @export\r\n * @class Events\r\n */\r\nexport default class Users {\r\n\r\n    /**\r\n     * Signup User record\r\n     *\r\n     * @param {object} req - HTTP Request\r\n     * @param {object} res - HTTP Response\r\n     * @returns {object} Class instance\r\n     * @memberof Users\r\n     */\r\n    createUser(req, res){\r\n\r\n        /***Encrypt Password***/\r\n        let salt = bcrypt.genSaltSync(Math.floor(Math.random() * 31));\r\n\r\n        let { firstName, lastName, email, password } = req.body;\r\n        let encryptedPassword = bcrypt.hashSync(password, salt);\r\n\r\n        User.findOne({\r\n            where: {\r\n                email: {\r\n                    [Op.iLike]: email\r\n                }\r\n            }\r\n        })\r\n        .then((foundUser) => {\r\n            if (foundUser) {\r\n                return res.status(401).json({\r\n                    statusCode: 401,\r\n                    message: 'Email has been taken, Please Choose another',\r\n                    error: true\r\n                });\r\n            }\r\n            return User.create({\r\n                firstName: firstName,\r\n                lastName: lastName,\r\n                email: email,\r\n                password: encryptedPassword\r\n            })\r\n            .then((user) => {\r\n                return res.status(201)\r\n                    .send({\r\n                        statusCode: 201,\r\n                        message: `Account Created for ${user.firstName} ${user.lastName}`,\r\n                        error: false\r\n                    });\r\n            })\r\n            .catch(err => res.status(500).json(err));\r\n        })\r\n        .catch(error => res.status(500).json(error));\r\n    }\r\n\r\n    loginUser(req, res){\r\n        let { email, password } = req.body;\r\n            User.findOne({\r\n                where: {\r\n                    email: {\r\n                        [Op.iLike]: email\r\n                    }\r\n                }\r\n            })\r\n            .then((foundUser) => {\r\n                if(!foundUser){\r\n                    return res.status(404).send({\r\n                        statusCode: 404,\r\n                        message: 'User Not Found! Please Sign Up',\r\n                        error: true,\r\n                    });\r\n                }\r\n                else if(bcrypt.compareSync(password, foundUser.password))\r\n                {\r\n                    return res.status(200).send({\r\n                        statusCode: 200,\r\n                        message: 'Here`s your Token',\r\n                        token: jwt.sign({\r\n                            id: foundUser.id,\r\n                            firstName: foundUser.firstName,\r\n                            lastName: foundUser.lastName,\r\n                            email: foundUser.email,\r\n                            role: foundUser.role\r\n                        }, process.env.SECRET_KEY, { expiresIn: '24h' }),\r\n                        error: false\r\n                    });\r\n                }else{\r\n                    return res.status(401).send({\r\n                        statusCode: 401,\r\n                        message: 'Wrong password',\r\n                        error: true\r\n                    });\r\n                }\r\n            })\r\n            .catch(error => res.status(500).send(error));\r\n    }\r\n\r\n    currUser (req, res){\r\n      return res.send({\r\n        currentUser: req.currentUser\r\n      });\r\n    }\r\n\r\n    assignAdmin(req, res){\r\n        let { email, password } = req.body;\r\n        User.findOne({\r\n            where: {\r\n                email: {\r\n                    [Op.iLike]: email\r\n                }\r\n            }\r\n        })\r\n            .then((foundUser) => {\r\n                if(!foundUser){\r\n                    return res.status(404).send({\r\n                        statusCode: 404,\r\n                        message: 'User Not Found! Please Sign Up',\r\n                        error: true\r\n                    });\r\n                }\r\n                else if(bcrypt.compareSync(password, foundUser.password))\r\n                {\r\n                    // update user role to true...\r\n                    User.update({ role: true }, {\r\n                        where: {\r\n                            id: foundUser.id\r\n                        }\r\n                    })\r\n                    .then((updatedUser) => {\r\n                        let subject = 'Boots Events Manager: Administrator Assignment';\r\n                        let htmlOutput = `\r\n                            <h6>Boots Events Manager: Administrator Assignment</h6>\r\n                            <p>Dear, ${foundUser.firstName} ${foundUser.lastName} you have been Assigned as Administrator</p>\r\n                            <br />\r\n                            <ul>\r\n                                <li>First Name: ${foundUser.firstName}</li>\r\n                                <li>Last Name: ${foundUser.lastName}</li>\r\n                                <li>Email: ${foundUser.email}</li>\r\n                            </ul>\r\n                            <br />\r\n                            <h6>Admin Privileges</h6>\r\n                            <ul>\r\n                                <li>Centers: creation, updating, deleting</li>\r\n                            </ul>\r\n                        `;\r\n                        mailer(foundUser.email, subject, subject, htmlOutput);\r\n                        return res.status(200).send({\r\n                            statusCode: 200,\r\n                            message: 'User has been assigned as administrator email notification as been sent to ' + updatedUser.email,\r\n                            user: updatedUser\r\n                        });\r\n                    });\r\n                } else {\r\n                    return res.status(401).send({\r\n                        statusCode: 401,\r\n                        message: 'Wrong password',\r\n                        error: true\r\n                    });\r\n                }\r\n            })\r\n            .catch(error => res.status(500).send(error));\r\n    }\r\n\r\n    allUsers(req, res){\r\n        User.findAll()\r\n            .then((users) => {\r\n                return res.status(200).send({\r\n                    message: 'all users found',\r\n                    statusCode: 200,\r\n                    users\r\n                });\r\n            })\r\n            .catch(error => res.status(500).send(error));\r\n    }\r\n\r\n    removeUsers(req, res){\r\n        let { userId } = req.body;\r\n        User.findOne({\r\n            where: {\r\n                id: userId\r\n            }\r\n        })\r\n            .then((foundUser) => {\r\n                User.destroy({\r\n                    where: {\r\n                        id: foundUser.id\r\n                    }\r\n                })\r\n                    .then((deletedUser) => {\r\n                        if(deletedUser){\r\n                            res.status(200).send({\r\n                                message: 'User has been deleted successfully',\r\n                                error: false,\r\n                                user: foundUser\r\n                            });\r\n                        }else{\r\n                            res.send({\r\n                                message: 'User was not deleted, please try again',\r\n                                error: true\r\n                            });\r\n                        }\r\n                    })\r\n                    .catch(error => res.status(500).send({\r\n                        error: true,\r\n                        message: 'Houston we have a problem.!!',\r\n                        errorMessage: error\r\n                    }));\r\n            });\r\n    }\r\n}"]}