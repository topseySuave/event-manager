{"version":3,"sources":["../../server/controllers/Users.js"],"names":["userModel","User","Events","Op","sequelize","config","Users","req","res","salt","genSaltSync","Math","floor","random","body","firstName","lastName","email","password","role","encryptedPassword","hashSync","findOne","where","iLike","then","foundUser","status","json","statusCode","id","message","create","send","user","compareSync","token","sign","process","env","SECRET_KEY","expiresIn","currentUser","findAll","users","catch","error","userId","destroy","deletedUser","subject","htmlOutput","errorMessage"],"mappings":";;;;;;;;AAAA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;;;;;;;AAEA,IAAMA,YAAY,iBAAOC,IAAzB;IACQC,M,oBAAAA,M;IACAC,E,GAAO,iBAAOC,S,CAAdD,E;;AACR,iBAAOE,MAAP;;AAEA;;;;;IAIqBC,K;;;;;;;;AACnB;;;;;;;;+BAQWC,G,EAAKC,G,EAAK;AACnB;;AAEA,UAAMC,OAAO,mBAAOC,WAAP,CAAmBC,KAAKC,KAAL,CAAWD,KAAKE,MAAL,KAAgB,CAA3B,CAAnB,CAAb;;AAHmB,sBAOfN,IAAIO,IAPW;AAAA,UAMjBC,SANiB,aAMjBA,SANiB;AAAA,UAMNC,QANM,aAMNA,QANM;AAAA,UAMIC,KANJ,aAMIA,KANJ;AAAA,UAMWC,QANX,aAMWA,QANX;;AAQnB,UAAMC,OAAOZ,IAAIO,IAAJ,CAASK,IAAT,IAAiB,KAA9B;AACA,UAAMC,oBAAoB,mBAAOC,QAAP,CAAgBH,QAAhB,EAA0BT,IAA1B,CAA1B;;AAEAT,gBAAUsB,OAAV,CAAkB;AAChBC,eAAO;AACLN,qCACGd,GAAGqB,KADN,EACcP,KADd;AADK;AADS,OAAlB,EAOGQ,IAPH,CAOQ,UAACC,SAAD,EAAe;AACnB,YAAIA,SAAJ,EAAe;AACb,iBAAOlB,IAAImB,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAC1BC,wBAAY,GADc;AAE1BC,gBAAIJ,UAAUI,EAFY;AAG1BC,qBAAS;AAHiB,WAArB,CAAP;AAKD;AACD,eAAO/B,UAAUgC,MAAV,CAAiB;AACtBjB,8BADsB;AAEtBC,4BAFsB;AAGtBC,sBAHsB;AAItBC,oBAAUE,iBAJY;AAKtBD;AALsB,SAAjB,EAOJM,IAPI,CAOC;AAAA,iBAAQjB,IAAImB,MAAJ,CAAW,GAAX,EACXM,IADW,CACN;AACJJ,wBAAY,GADR;AAEJC,gBAAII,KAAKJ,EAFL;AAGJC,8CAAgCG,KAAKnB,SAArC,SAAkDmB,KAAKlB;AAHnD,WADM,CAAR;AAAA,SAPD,CAAP;AAaD,OA5BH;AA6BD;;AAED;;;;;;;;;;;8BAQUT,G,EAAKC,G,EAAK;AAAA,uBACUD,IAAIO,IADd;AAAA,UACVG,KADU,cACVA,KADU;AAAA,UACHC,QADG,cACHA,QADG;;AAElBlB,gBAAUsB,OAAV,CAAkB;AAChBC,eAAO;AACLN,qCACGd,GAAGqB,KADN,EACcP,KADd;AADK;AADS,OAAlB,EAOGQ,IAPH,CAOQ,UAACC,SAAD,EAAe;AACnB,YAAI,CAACA,SAAL,EAAgB;AACd,iBAAOlB,IAAImB,MAAJ,CAAW,GAAX,EAAgBM,IAAhB,CAAqB;AAC1BJ,wBAAY,GADc;AAE1BE,qBAAS;AAFiB,WAArB,CAAP;AAID,SALD,MAKO,IAAI,mBAAOI,WAAP,CAAmBjB,QAAnB,EAA6BQ,UAAUR,QAAvC,CAAJ,EAAsD;AAC3D,iBAAOV,IAAImB,MAAJ,CAAW,GAAX,EAAgBM,IAAhB,CAAqB;AAC1BJ,wBAAY,GADc;AAE1BE,qBAAS,mBAFiB;AAG1BK,mBAAO,uBAAIC,IAAJ,CAAS;AACdP,kBAAIJ,UAAUI,EADA;AAEdd,wBAAUU,UAAUV,QAFN;AAGdG,oBAAMO,UAAUP;AAHF,aAAT,EAIJmB,QAAQC,GAAR,CAAYC,UAJR,EAIoB,EAAEC,WAAW,KAAb,EAJpB;AAHmB,WAArB,CAAP;AASD;AACD,eAAOjC,IAAImB,MAAJ,CAAW,GAAX,EAAgBM,IAAhB,CAAqB;AAC1BJ,sBAAY,GADc;AAE1BE,mBAAS;AAFiB,SAArB,CAAP;AAID,OA5BH;AA6BD;;AAED;;;;;;;;;;;6BAQSxB,G,EAAKC,G,EAAK;AACjB,aAAOA,IAAIyB,IAAJ,CAAS;AACdH,YAAIvB,IAAImC,WAAJ,CAAgBZ,EADN;AAEdb,eAAOV,IAAImC,WAAJ,CAAgBzB;AAFT,OAAT,CAAP;AAID;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;;;;;;;;;;6BAQSV,G,EAAKC,G,EAAK;AACjBR,gBAAU2C,OAAV,GACGlB,IADH,CACQ;AAAA,eAASjB,IAAImB,MAAJ,CAAW,GAAX,EAAgBM,IAAhB,CAAqB;AAClCF,mBAAS,iBADyB;AAElCF,sBAAY,GAFsB;AAGlCe;AAHkC,SAArB,CAAT;AAAA,OADR,EAMGC,KANH,CAMS;AAAA,eAASrC,IAAImB,MAAJ,CAAW,GAAX,EAAgBM,IAAhB,CAAqBa,KAArB,CAAT;AAAA,OANT;AAOD;;AAED;;;;;;;;;;;gCAQYvC,G,EAAKC,G,EAAK;AAAA,UACZuC,MADY,GACDxC,IAAIO,IADH,CACZiC,MADY;;AAEpB/C,gBAAUsB,OAAV,CAAkB;AAChBC,eAAO;AACLO,cAAIiB;AADC;AADS,OAAlB,EAKGtB,IALH,CAKQ,UAACC,SAAD,EAAe;AACnB,YAAIA,SAAJ,EAAe;AACb1B,oBAAUgD,OAAV,CAAkB;AAChBzB,mBAAO;AACLO,kBAAIJ,UAAUI;AADT;AADS,WAAlB,EAKGL,IALH,CAKQ,UAACwB,WAAD,EAAiB;AACrB,gBAAIA,WAAJ,EAAiB;AACf,kBAAMC,UAAU,gDAAhB;AACA,kBAAIC,8IAEmBzB,UAAUX,SAF7B,SAE0CW,UAAUV,QAFpD,2KAK8BU,UAAUX,SALxC,8DAM6BW,UAAUV,QANvC,0DAOyBU,UAAUT,KAPnC,oUAAJ;AAeA,kBAAI,sBAAOS,UAAUT,KAAjB,EAAwBiC,OAAxB,EAAiCA,OAAjC,EAA0CC,UAA1C,CAAJ,EAA0D;AACxD3C,oBAAImB,MAAJ,CAAW,GAAX,EAAgBM,IAAhB,CAAqB;AACnBF,2BAAS,qCADU;AAEnBG,wBAAMR;AAFa,iBAArB;AAID;AACF,aAvBD,MAuBO;AACLlB,kBAAIyB,IAAJ,CAAS;AACPF,yBAAS;AADF,eAAT;AAGD;AACF,WAlCH,EAmCGc,KAnCH,CAmCS;AAAA,mBAASrC,IAAImB,MAAJ,CAAW,GAAX,EAAgBM,IAAhB,CAAqB;AACnCF,uBAAS,mDAD0B;AAEnCqB,4BAAcN;AAFqB,aAArB,CAAT;AAAA,WAnCT;AAuCD,SAxCD,MAwCO;AACLtC,cAAImB,MAAJ,CAAW,GAAX,EAAgBM,IAAhB,CAAqB;AACnBF,qBAAS;AADU,WAArB;AAGD;AACF,OAnDH;AAoDD;;;;;;kBA9PkBzB,K","file":"Users.js","sourcesContent":["import dotenv from 'dotenv';\nimport bcrypt from 'bcryptjs';\nimport jwt from 'jsonwebtoken';\nimport models from '../models';\nimport mailer from '../middleware/mailer';\n\nconst userModel = models.User;\nconst { Events } = models;\nconst { Op } = models.sequelize;\ndotenv.config();\n\n/**\n * @export\n * @class Events\n */\nexport default class Users {\n  /**\n   * Signup Users record\n   *\n   * @param {object} req - HTTP Request\n   * @param {object} res - HTTP Response\n   * @returns {object} Class instance\n   * @memberof Users\n   */\n  createUser(req, res) {\n    /**\n     * Encrypt Password** */\n    const salt = bcrypt.genSaltSync(Math.floor(Math.random() * 5));\n\n    const {\n      firstName, lastName, email, password\n    } = req.body;\n    const role = req.body.role || false;\n    const encryptedPassword = bcrypt.hashSync(password, salt);\n\n    userModel.findOne({\n      where: {\n        email: {\n          [Op.iLike]: email\n        }\n      }\n    })\n      .then((foundUser) => {\n        if (foundUser) {\n          return res.status(400).json({\n            statusCode: 400,\n            id: foundUser.id,\n            message: 'Email has been taken, Please Choose another'\n          });\n        }\n        return userModel.create({\n          firstName,\n          lastName,\n          email,\n          password: encryptedPassword,\n          role\n        })\n          .then(user => res.status(201)\n            .send({\n              statusCode: 201,\n              id: user.id,\n              message: `Account Created for ${user.firstName} ${user.lastName}`\n            }));\n      });\n  }\n\n  /**\n   * Signin Users record\n   *\n   * @param {object} req - HTTP Request\n   * @param {object} res - HTTP Response\n   * @returns {object} Class instance\n   * @memberof Users\n   */\n  loginUser(req, res) {\n    const { email, password } = req.body;\n    userModel.findOne({\n      where: {\n        email: {\n          [Op.iLike]: email\n        }\n      }\n    })\n      .then((foundUser) => {\n        if (!foundUser) {\n          return res.status(404).send({\n            statusCode: 404,\n            message: 'Users Not Found! Please Sign Up'\n          });\n        } else if (bcrypt.compareSync(password, foundUser.password)) {\n          return res.status(200).send({\n            statusCode: 200,\n            message: 'signin successful',\n            token: jwt.sign({\n              id: foundUser.id,\n              lastName: foundUser.lastName,\n              role: foundUser.role\n            }, process.env.SECRET_KEY, { expiresIn: '24h' })\n          });\n        }\n        return res.status(401).send({\n          statusCode: 401,\n          message: 'Wrong password',\n        });\n      });\n  }\n\n  /**\n   * GETS Current Users record\n   *\n   * @param {object} req - HTTP Request\n   * @param {object} res - HTTP Response\n   * @returns {object} Class instance\n   * @memberof Users\n   */\n  currUser(req, res) {\n    return res.send({\n      id: req.currentUser.id,\n      email: req.currentUser.email\n    });\n  }\n\n  // /**\n  //  * Assign a Users as admin\n  //  *\n  //  * @param {object} req - HTTP Request\n  //  * @param {object} res - HTTP Response\n  //  * @returns {object} Class instance\n  //  * @memberof Users\n  //  */\n  // assignAdmin(req, res) {\n  //   const { email, password } = req.body;\n  //   userModel.findOne({\n  //     where: {\n  //       email: {\n  //         [Op.iLike]: email\n  //       }\n  //     }\n  //   })\n  //     .then((foundUser) => {\n  //       if (!foundUser) {\n  //         return res.status(404).send({\n  //           statusCode: 404,\n  //           message: 'User Not Found! Please Sign Up'\n  //         });\n  //       } else if (bcrypt.compareSync(password, foundUser.password)) {\n  //         // update user role to true...\n  //         userModel.update({ role: true }, {\n  //           where: {\n  //             id: foundUser.id\n  //           }\n  //         })\n  //           .then((updatedUser) => {\n  //             const subject = 'Boots Events Manager: Administrator Assignment';\n  //             let htmlOutput = `\n  //                           <h6>Boots Events Manager: Administrator Assignment</h6>\n  //                           <p>Dear, ${foundUser.firstName} ${foundUser.lastName} you have been Assigned as Administrator</p>\n  //                           <br />\n  //                           <ul>\n  //                               <li>First Name: ${foundUser.firstName}</li>\n  //                               <li>Last Name: ${foundUser.lastName}</li>\n  //                               <li>Email: ${foundUser.email}</li>\n  //                           </ul>\n  //                           <br />\n  //                           <h6>Admin Privileges</h6>\n  //                           <ul>\n  //                               <li>Centers: creation, updating, deleting</li>\n  //                           </ul>\n  //                       `;\n\n  //             mailer(foundUser.email, subject, subject, htmlOutput, () => res.status(400).send({\n  //               statusCode: 400,\n  //               message: `${foundUser.firstName} could not be notified`\n  //             }),\n  //             () => res.status(200).send({\n  //               statusCode: 200,\n  //               message: `${foundUser.firstName} has been notified`\n  //             }));\n  //           });\n  //       } else {\n  //         return res.status(401).send({\n  //           statusCode: 401,\n  //           message: 'Wrong password'\n  //         });\n  //       }\n  //     })\n  //     .catch(error => res.status(500).send(error));\n  // }\n\n  /**\n   * GETS all Users record\n   *\n   * @param {object} req - HTTP Request\n   * @param {object} res - HTTP Response\n   * @returns {object} Class instance\n   * @memberof Users\n   */\n  allUsers(req, res) {\n    userModel.findAll()\n      .then(users => res.status(200).send({\n        message: 'all users found',\n        statusCode: 200,\n        users\n      }))\n      .catch(error => res.status(500).send(error));\n  }\n\n  /**\n   * DELETE a Users record\n   *\n   * @param {object} req - HTTP Request\n   * @param {object} res - HTTP Response\n   * @returns {object} Class instance\n   * @memberof Users\n   */\n  removeUsers(req, res) {\n    const { userId } = req.body;\n    userModel.findOne({\n      where: {\n        id: userId\n      }\n    })\n      .then((foundUser) => {\n        if (foundUser) {\n          userModel.destroy({\n            where: {\n              id: foundUser.id\n            }\n          })\n            .then((deletedUser) => {\n              if (deletedUser) {\n                const subject = 'Dropped as Administrator: Boots Events Manager';\n                let htmlOutput = `\n                            <h6>Dropped as Administrator: Boots Events Manager</h6>\n                            <p>Dear, ${foundUser.firstName} ${foundUser.lastName} you have been Dropped as Administrator</p>\n                            <br />\n                            <ul>\n                                <li>First Name: ${foundUser.firstName}</li>\n                                <li>Last Name: ${foundUser.lastName}</li>\n                                <li>Email: ${foundUser.email}</li>\n                            </ul>\n                            <br />\n                            <h6>Admin Privileges relinquished</h6>\n                            <ul>\n                                <li>Centers: creation, updating, deleting</li>\n                            </ul>\n                        `;\n                if (mailer(foundUser.email, subject, subject, htmlOutput)){\n                  res.status(200).send({\n                    message: 'Users has been deleted successfully',\n                    user: foundUser\n                  });\n                }\n              } else {\n                res.send({\n                  message: 'Users was not deleted, please try again'\n                });\n              }\n            })\n            .catch(error => res.status(500).send({\n              message: 'Houston we have a problem.!! Error deleting Users',\n              errorMessage: error\n            }));\n        } else {\n          res.status(404).send({\n            message: 'User was not found',\n          });\n        }\n      });\n  }\n}\n"]}